#!/bin/bash
# Pre-commit hook for Audio Ninja
# Install: git config core.hooksPath .githooks

set -e

echo "ğŸ” Running pre-commit validation..."

# Check formatting
echo "  â”œâ”€ Checking code format..."
if ! cargo fmt --all -- --check; then
    echo "  âŒ Format check failed. Run: cargo fmt --all"
    exit 1
fi
echo "  âœ… Format check passed"

# Run clippy
echo "  â”œâ”€ Running clippy..."
if ! cargo clippy --workspace --all-targets --all-features -- -D warnings; then
    echo "  âŒ Clippy failed. Fix warnings or run: cargo clippy --fix"
    exit 1
fi
echo "  âœ… Clippy passed"

# Run tests (skip E2E tests for speed)
echo "  â”œâ”€ Running tests..."
if ! cargo test --workspace -- --skip e2e_; then
    echo "  âŒ Tests failed"
    exit 1
fi
echo "  âœ… Tests passed"

# Build documentation
echo "  â”œâ”€ Building documentation..."
if ! cargo doc --workspace --no-deps --all-features 2>&1 | grep -v "warning: unused"; then
    echo "  âŒ Documentation build failed"
    exit 1
fi
echo "  âœ… Documentation built"

echo "âœ… All pre-commit checks passed!"
